# Migration `watch-20190824181948`

This migration has been generated by Tyler Maschino at 8/24/2019, 6:19:49 PM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "lift"."User"("id" TEXT NOT NULL  ,"createdAt" DATE NOT NULL  ,"updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,"email" TEXT NOT NULL DEFAULT '' ,"password" TEXT   ,"resetToken" TEXT   ,"resetTokenExpiry" INTEGER   ,"plan" TEXT   REFERENCES "Plan"(id) ON DELETE SET NULL,PRIMARY KEY ("id"))
;

CREATE TABLE "lift"."Plan"("id" TEXT NOT NULL  ,"createdAt" DATE NOT NULL  ,"updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,"name" TEXT   ,"level" INTEGER NOT NULL DEFAULT 0 ,"siteLimit" INTEGER   ,PRIMARY KEY ("id"))
;

CREATE TABLE "lift"."UserSite"("id" TEXT NOT NULL  ,"createdAt" DATE   ,"updatedAt" DATE   ,"associatesApiKey" TEXT   ,"contentSelector" TEXT   ,"scanFreq" TEXT   ,"user" TEXT   REFERENCES "User"(id) ON DELETE SET NULL,"site" TEXT   REFERENCES "Site"(id) ON DELETE SET NULL,PRIMARY KEY ("id"))
;

CREATE TABLE "lift"."Site"("id" TEXT NOT NULL  ,"createdAt" DATE NOT NULL  ,"updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,"hostname" TEXT NOT NULL DEFAULT '' ,PRIMARY KEY ("id"))
;

CREATE TABLE "lift"."Page"("id" TEXT NOT NULL  ,"createdAt" DATE NOT NULL  ,"updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,"url" TEXT NOT NULL DEFAULT '' ,"pageTitle" TEXT   ,"wordCount" INTEGER   ,"site" TEXT   REFERENCES "Site"(id) ON DELETE SET NULL,PRIMARY KEY ("id"))
;

CREATE TABLE "lift"."Link"("id" TEXT NOT NULL  ,"createdAt" DATE NOT NULL  ,"updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,"href" TEXT NOT NULL DEFAULT '' ,"affiliateTagged" BOOLEAN   ,"affiliateTagName" TEXT   ,"anchorText" TEXT   ,"page" TEXT   REFERENCES "Page"(id) ON DELETE SET NULL,"product" TEXT   REFERENCES "Product"(id) ON DELETE SET NULL,PRIMARY KEY ("id"))
;

CREATE TABLE "lift"."Product"("id" TEXT NOT NULL  ,"createdAt" DATE NOT NULL  ,"updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,"name" TEXT   ,"asin" TEXT NOT NULL DEFAULT '' ,"availability" TEXT NOT NULL DEFAULT 'AMAZON' ,PRIMARY KEY ("id"))
;

CREATE UNIQUE INDEX "lift"."User.id._UNIQUE" ON "User"("id")

CREATE UNIQUE INDEX "lift"."User.email._UNIQUE" ON "User"("email")

CREATE UNIQUE INDEX "lift"."Plan.id._UNIQUE" ON "Plan"("id")

CREATE UNIQUE INDEX "lift"."Plan.name._UNIQUE" ON "Plan"("name")

CREATE UNIQUE INDEX "lift"."Plan.level._UNIQUE" ON "Plan"("level")

CREATE UNIQUE INDEX "lift"."UserSite.id._UNIQUE" ON "UserSite"("id")

CREATE UNIQUE INDEX "lift"."Site.id._UNIQUE" ON "Site"("id")

CREATE UNIQUE INDEX "lift"."Site.hostname._UNIQUE" ON "Site"("hostname")

CREATE UNIQUE INDEX "lift"."Page.id._UNIQUE" ON "Page"("id")

CREATE UNIQUE INDEX "lift"."Page.url._UNIQUE" ON "Page"("url")

CREATE UNIQUE INDEX "lift"."Link.id._UNIQUE" ON "Link"("id")

CREATE UNIQUE INDEX "lift"."Product.id._UNIQUE" ON "Product"("id")

CREATE UNIQUE INDEX "lift"."Product.asin._UNIQUE" ON "Product"("asin")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..watch-20190824181948
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,91 @@
+datasource db {
+  provider = "sqlite"
+  url      = "file:dev.db"
+  default  = true
+}
+
+generator photon {
+  provider = "photonjs"
+}
+
+model User {
+  id               String     @default(cuid()) @id @unique
+  createdAt        DateTime   @default(now())
+  updatedAt        DateTime   @updatedAt
+  email            String     @unique
+  password         String?
+  resetToken       String?
+  resetTokenExpiry Int?
+  sites            UserSite[]
+  plan             Plan?
+}
+
+model Plan {
+  id          String   @default(cuid()) @id @unique
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+  name        String?  @unique
+  level       Int      @unique
+  subscribers User[]
+  siteLimit   Int?
+}
+
+model UserSite {
+  id               String    @default(cuid()) @id @unique
+  createdAt        DateTime? @default(now())
+  updatedAt        DateTime? @updatedAt
+  associatesApiKey String?
+  contentSelector  String?
+  user             User
+  site             Site
+  scanFreq         String?
+}
+
+model Site {
+  id        String     @default(cuid()) @id @unique
+  createdAt DateTime   @default(now())
+  updatedAt DateTime   @updatedAt
+  hostname  String     @unique
+  pages     Page[]
+  userSites UserSite[]
+}
+
+model Page {
+  id        String   @default(cuid()) @id @unique
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  url       String   @unique
+  pageTitle String?
+  wordCount Int?
+  links     Link[]
+  site      Site
+}
+
+model Link {
+  id               String   @default(cuid()) @id @unique
+  createdAt        DateTime @default(now())
+  updatedAt        DateTime @updatedAt
+  page             Page
+  href             String
+  affiliateTagged  Boolean?
+  affiliateTagName String?
+  product          Product?
+  anchorText       String?
+}
+
+model Product {
+  id           String       @default(cuid()) @id @unique
+  createdAt    DateTime     @default(now())
+  updatedAt    DateTime     @updatedAt
+  name         String?
+  asin         String       @unique
+  links        Link[]
+  availability Availability
+}
+
+enum Availability {
+  AMAZON
+  THIRDPARTY
+  UNAVAILABLE
+  NOTFOUND
+}
```

## Photon Usage

You can use a specific Photon built for this migration (watch-20190824181948)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/watch-20190824181948'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
