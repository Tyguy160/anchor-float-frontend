datasource db {
  provider = "postgres"
  url      = "postgresql://postgres:postgres@database:5432/associate_engine?schema=public"
  default  = true
}

generator photon {
  provider = "photonjs"
}

model User {
  id               String     @default(cuid()) @id @unique
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  email            String     @unique
  firstName        String?
  lastName         String?
  password         String?
  resetToken       String?
  resetTokenExpiry Int?
  sites            UserSite[]
  plan             Plan?
}

model Plan {
  id          String   @default(cuid()) @id @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  name        String?  @unique
  level       Int      @unique
  subscribers User[]
  siteLimit   Int?
}

model UserSite {
  id               String    @default(cuid()) @id @unique
  createdAt        DateTime? @default(now())
  updatedAt        DateTime? @updatedAt
  associatesApiKey String?
  contentSelector  String?
  user             User
  site             Site
  scanFreq         String?
  minimumReview    String?
}

model Site {
  id        String     @default(cuid()) @id @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  hostname  String     @unique
  pages     Page[]
  userSites UserSite[]
}

model Page {
  id        String   @default(cuid()) @id @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  url       String   @unique
  pageTitle String?
  wordCount Int?
  links     Link[]
  site      Site
}

model Link {
  id               String   @default(cuid()) @id @unique
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  page             Page
  href             String
  affiliateTagged  Boolean?
  affiliateTagName String?
  product          Product?
  anchorText       String?
}

model Product {
  id           String       @default(cuid()) @id @unique
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  name         String?
  asin         String       @unique
  links        Link[]
  availability Availability
}

enum Availability {
  AMAZON
  THIRDPARTY
  UNAVAILABLE
  NOTFOUND
}